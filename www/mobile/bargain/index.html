<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>砍价活动</title>
    <link rel="stylesheet" type="text/css" href="kj.css">
    <script src="vue.min.js"></script>
</head>
<body>
<div class="box" id="box" v-cloak>
    <div style="font-size: 14px;text-align:center;position: absolute;top: 0;left: 0;right: 0;">
        <a style=" color: #2340B6;font-weight: 500;margin: 0 auto;line-height: 34px;border-bottom:0.6px solid #0710B9;">《活动规则》</a>
    </div>
    <div class="success">
        <div class="success-pic">
            <img style="height: 100%;width: 100%" src="ios/图层5@2x.png">
        </div>
        <div class="success-message">
            <div class="success-rate">
                <div class="rate-left">
                    <p>原价</p>
                    <p style="font-size: 25px" v-text="mydata.startMoney"></p>
                </div>
                <div class="rate-center">
                    <div style=" position:relative; border:1px #FFDE6D solid; border-radius:20px;height:40px; width:95%; margin: 5px auto; padding:2px 1.5px;">
                        <div style="background: linear-gradient(to bottom, #FFDE6D, #FFC002,#FFDE6D); border-radius:20px;height: 34px; width:66.6%"></div>
                    </div>
                </div>
                <div class="rate-right">
                    <p>目标</p>
                    <p style="font-size: 25px" v-text="mydata.aimsMoney"></p>
                </div>
            </div>
            <div class="success-remaining">
                <p>已砍{{mydata.startMoney-mydata.endMoney}}元，还剩{{mydata.endMoney-mydata.aimsMoney}}元</p>
            </div>
        </div>
    </div>
    <div style="border-radius: 5px;text-align: center;width: 60%;font-size: 14px;background-color: rgba(255,255,255,0.15);margin: 10px auto;height: 35px;">
        <p style="line-height: 35px">吴鹏刚刚砍了666元</p>
    </div>
    <div class="complete-message">
        <div style="text-align: left; font-size: 14px;letter-spacing: 1px;line-height: 20px">
            <p class="guizhe" style="text-indent: 2em">欢迎参加本次的项目砍价活动，在这次活动里，您可要通过分享链接给朋友或者朋友圈来邀请朋友帮您砍价,活动结束时，将会根据您最终砍价的结果来作为您的项目花费金额，赶快邀请朋友来帮您砍价吧！</p>
        </div>
        <div class="tips">
            <p>Tips：邀请的好友越多，能砍</p>
            <p>的价格越高哦！</p>
        </div>
        <button class="btn_share" >
            <p style="margin:1px 5px">分享给朋友来砍价&#8680</p>
        </button>
    </div>
    <div class="list-footer">
        <p>本活动由猴小胖平台提供技术支持</p>
    </div>
</div>
<script type="text/javascript" src="index.js"></script>
<script>
    var code = getQueryString("code");
    var demand_id = getQueryString("state");
    console.log(demand_id)
    if(demand_id){
    new Vue({
        el:"#box",
        data:{
            mydata:{
				startMoney:null,
				endMoney:null,
				aimsMoney:null
            },
            login:false
        },
        methods:{
            logined(collback){
                ajax({
                    url: "https://www.houxiaopang.com/api/v1.2/bargain/loginverification",
                    timeout: 5000,
                    success:function(res){
                        if(res.code === 0){
                            collback();
                        }else{
location.href = "https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx35c4ce958bc7eb68&redirect_uri=https%3A%2F%2Fm.houxiaopang.com%2Fbargain&response_type=code&scope=snsapi_userinfo&state="+demand_id+"#wechat_redirect";
                        }
                    },
                    error:function(){
                        alert("网络拥挤，请稍后再试。")
                    }
                })
            },
            login(){
                var that = this;
                ajax({
                    url: "https://www.houxiaopang.com/api/v1.2/bargain/login",
                    timeout: 5000,
                    success:function(res){
                        if(res.code === 0){
                            that.mydata= res.data.demand;
                        }
                        else if(res.code === -2){
                            alert(res.data.errorMsg);
                        }else {
                            alert("网络拥挤，请稍后再试。")
                        }
                    },
                    error:function(){
                        alert("网络拥挤，请稍后再试。")
                    }
                })
            },
            getfirstpage(){
                var that = this;
                ajax({
                    url: "https://www.houxiaopang.com/api/v1.2/bargain/getfirstpage",
                    data: {
                        id: demand_id
                    },
                    timeout: 5000,
                    success:function(res){
                        if(res.code === 0){
                            that.mydata= res.data.demand;
                        }
                        else if(res.code === -2){
                            alert(res.data.errorMsg);
                        }else {
                            alert("网络拥挤，请稍后再试。")
                        }
                    },
                    error:function(){
                        alert("网络拥挤，请稍后再试。")
                    }
                })
            }
        },
        created:function () {
            var that = this
            if (code) {
                ajax({
                    url: "https://www.houxiaopang.com/api/v1.2/bargain/login",
                    data: {
                        code: code
                    },
                    timeout: 5000,
                    success:function(res){
                        if (res.code === 0) {
                            location.href = "https://m.houxiaopang.com/bargain?demandid="+demand_id;
                        } else {
                           alert("登录失败，请重试。")
                        }
                    },
                    error:function(){
                        alert("网络拥挤，请稍后再试。")
                    }
                })
            } else {
                this.logined(this.getfirstpage)
            }
        }
    })
    }else{
        location.href ="http://www.houxiaopang.com/404";
    }

</script>
</body>
</html>