webpackJsonp([13],{11:function(t,e,a){a(224);var n=a(4)(a(129),a(264),"data-v-ef6eab44",null);t.exports=n.exports},129:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={data:{c:null,can:null,start:{x:0,y:0},first:{x:0,y:0},color:"#FF445B",colors:"",lineWidth:2,startdraw:!1,candraw:!1,scroll:0,scrollY:0,num:1,saves:[],saveindex:-1,move:!1},init:function(t){this.data.can=document.getElementById("can"),this.data.can.width=t.offsetWidth,this.data.can.height=t.offsetHeight,this.data.c=this.data.can.getContext("2d"),this.drawInit(this.data.can)},drawLine:function(t,e,a){t.strokeStyle=this.data.color,t.lineWidth=this.data.lineWidth,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(a.x,a.y),t.stroke(),t.closePath()},drawText:function(t,e,a){e.x<10&&(e.x=10),e.x+10>this.data.can.width&&(e.x=this.data.can.width-10),e.y+10>this.data.can.height&&(e.y=this.data.can.height-10),e.y<10&&(e.y=10),t.beginPath(),t.arc(e.x,e.y,10,0,2*Math.PI),t.fillStyle=this.data.color,t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#fff",t.font="12px impact",a<10?t.fillText(a,e.x-3,e.y+4):t.fillText(a,e.x-7,e.y+4),t.closePath()},drawInit:function(t){var e=this;t.ontouchstart=function(t){if(e.data.candraw&&1===t.touches.length){if(t.preventDefault(),e.data.scroll=document.getElementById("div_parent").scrollTop,e.data.start.x=t.touches[0].pageX,e.data.start.y=t.touches[0].pageY+e.data.scroll,e.data.first=e.data.start,e.data.startdraw=!0,e.data.saveindex!==e.data.saves.length-1)if(-1===e.data.saveindex)e.data.saves=[];else{for(var a=[],n=0,i=e.data.saves.length;n<i&&n<=e.data.saveindex;n++)a.push(e.data.saves[n]);e.data.saves=a}}else t.touches.length>1&&(e.data.move=!0,e.data.scrollY=t.touches[0].pageY)},t.ontouchmove=function(t){if(e.data.startdraw&&1===t.touches.length&&!e.data.move){var a={};a.x=t.touches[0].pageX,a.y=t.touches[0].pageY+e.data.scroll,e.drawLine(e.data.c,e.data.start,a),e.data.start=a}else if(e.data.move&&e.data.candraw){var n=e.data.scrollY-t.touches[0].pageY;document.getElementById("div_parent").scrollTop+=n,e.data.scrollY=t.touches[0].pageY}},t.ontouchend=function(t){e.data.startdraw&&0===t.touches.length&&(e.data.move?e.data.move=!1:(e.drawText(e.data.c,e.data.first,e.data.num),e.data.saves.push(e.data.c.getImageData(0,0,e.data.can.width,e.data.can.height)),e.data.saveindex++),e.data.startdraw=!1)}}};e.default={data:function(){return{src:"",start:!1,showcolors:!1,colors:["#FF445B","#4762FF","#333333"],color:"#FF445B",pizhu:{image:null,desc:null},desc:"",showinput:!1,pz:[],showpz:!0}},created:function(){showload("初始化中");var t=this.$route.query.id,e=this.$route.query.src;if(!t||!e)return void this.$router.push("/");this.getinfo(t)},watch:{start:function(){this.start?(document.getElementById("div_parent").scrollTop=0,n.data.candraw=!0):(n.data.candraw=!1,this.$nextTick(function(){document.getElementById("div_parent").scrollTop=19941209})),n.data.c.clearRect(0,0,n.data.can.width,n.data.can.height)}},methods:{aler:function(){showModal("用两个手指可实现上下滑动")},setbase:function(t){return t.replace(/ /g,"+")},getinfo:function(t){var e=this;ajax({url:"http://www.houxiaopang.com/api/v1.2/circle/getcomments",data:{id:t},success:function(t){e.pz=t.data.comments,n.data.num=e.pz.length+1,e.src=e.$route.query.src;var a=document.getElementById("image");a.addEventListener("load",function(){n.init(a),hideload()})},error:function(){showModal("网络拥挤，请稍后再试。"),hideload()}})},setcolor:function(t){n.data.color=t,this.color=t},over:function(){this.pizhu.image=n.data.can.toDataURL("image/png"),this.showinput=!0,this.$nextTick(function(){document.getElementById("a_descinput").focus()})},back:function(){this.showinput&&(this.showinput=!1)},submit:function(){if(""===this.desc.trim())return void showModal("请填写批注");if(0===n.data.saves.length)return void showModal("您还没有给作品添加过批注哦");showload("保存中");var t=this;ajax({url:"http://www.houxiaopang.com/api/v1.2/circle/addcomment",data:{commentIndex:n.data.num,description:t.desc.trim(),content:t.pizhu.image,imageId:t.$route.query.id},type:"post",success:function(e){0===e.code?(t.pz.push({commentIndex:n.data.num,description:t.desc.trim(),content:t.pizhu.image,upTime:e.data.up_time}),t.showinput=!1,t.start=!1,n.data.num++,t.desc="",n.data.saves=[],n.data.saveindex=-1):showModal(),hideload()},error:function(){showModal(),hideload()}})},cancel:function(){this.showinput=!1,this.start=!1,this.desc="",n.data.saves=[],n.data.saveindex=-1,this.start=!1},undo:function(){n.data.saveindex>0?(n.data.saveindex--,n.data.c.putImageData(n.data.saves[n.data.saveindex],0,0)):0===n.data.saveindex&&(n.data.saveindex=-1,n.data.c.clearRect(0,0,n.data.can.width,n.data.can.height))},redo:function(){n.data.saveindex<n.data.saves.length-1&&(n.data.saveindex++,n.data.c.putImageData(n.data.saves[n.data.saveindex],0,0))}}}},203:function(t,e,a){e=t.exports=a(27)(),e.push([t.i,".a_warp[data-v-ef6eab44]{height:100%;position:relative;background:#f4f4f4}.a_content[data-v-ef6eab44]{bottom:50px;position:absolute;left:0;top:0;width:100%;overflow-y:auto;overflow-x:hidden}.a_foot_after[data-v-ef6eab44],.a_foot_be[data-v-ef6eab44]{height:50px;position:absolute;bottom:0;width:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;-webkit-box-align:center;-webkit-align-items:center;align-items:center;background:#fff;border-top:1px solid #dedede}.a_color[data-v-ef6eab44]{height:25px;width:25px;position:relative}.a_colors[data-v-ef6eab44]{position:absolute;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;width:100px;height:40px;top:-44px;left:-38px}.a_colors[data-v-ef6eab44],.a_text[data-v-ef6eab44]{display:-webkit-box;display:-webkit-flex;display:flex}.a_text[data-v-ef6eab44]{height:50px;width:100%;position:fixed;bottom:0;z-index:19941209;left:0;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-justify-content:space-around;justify-content:space-around;padding:10px 15px;background:#fff;border-top:1px solid #dedede}.a_text>input[data-v-ef6eab44]{width:80%;margin-left:2px;height:30px;padding:0 10px}.a_image[data-v-ef6eab44]{position:absolute;top:0;left:0;width:100%;display:block}.a_list[data-v-ef6eab44]{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;border-bottom:1px solid #dedede;padding:5px 0}.a_arcnum[data-v-ef6eab44],.a_list[data-v-ef6eab44]{display:-webkit-box;display:-webkit-flex;display:flex}.a_arcnum[data-v-ef6eab44]{height:25px;width:25px;background:#ff445b;border-radius:50%;color:#fff;font-weight:600;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center}.a_pizhu[data-v-ef6eab44]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;padding:10px 15px 0;border-top:1px solid #dedede;background:#fff}.isnone[data-v-ef6eab44]{border:none}","",{version:3,sources:["C:/vue/mobile/src/components/Annotation.vue"],names:[],mappings:"AACA,yBACE,YAAa,AACb,kBAAmB,AACnB,kBAAoB,CACrB,AACD,4BACE,YAAa,AACb,kBAAmB,AACnB,OAAQ,AACR,MAAO,AACP,WAAY,AACZ,gBAAiB,AACjB,iBAAmB,CACpB,AAiBD,2DAfE,YAAa,AACb,kBAAmB,AACnB,SAAU,AACV,WAAY,AACZ,oBAAqB,AACrB,qBAAsB,AACtB,aAAc,AACd,qCAAsC,AAC9B,6BAA8B,AACtC,yBAA0B,AAC1B,2BAA4B,AACpB,mBAAoB,AAC5B,gBAAiB,AACjB,4BAA8B,CAiB/B,AACD,0BACE,YAAa,AACb,WAAY,AACZ,iBAAmB,CACpB,AACD,2BACE,kBAAmB,AACnB,yBAA0B,AAC1B,sCAAuC,AAC/B,8BAA+B,AAIvC,YAAa,AACb,YAAa,AACb,UAAW,AACX,UAAY,CACb,AACD,oDARE,oBAAqB,AACrB,qBAAsB,AACtB,YAAc,CAwBf,AAlBD,yBACE,YAAa,AACb,WAAY,AACZ,eAAgB,AAChB,SAAU,AACV,iBAAkB,AAClB,OAAQ,AAIR,yBAA0B,AAC1B,2BAA4B,AACpB,mBAAoB,AAC5B,qCAAsC,AAC9B,6BAA8B,AACtC,kBAAmB,AACnB,gBAAiB,AACjB,4BAA8B,CAC/B,AACD,+BACE,UAAW,AACX,gBAAiB,AACjB,YAAa,AACb,cAAgB,CACjB,AACD,0BACE,kBAAmB,AACnB,MAAO,AACP,OAAQ,AACR,WAAY,AACZ,aAAe,CAChB,AACD,yBAIE,4BAA6B,AAC7B,6BAA8B,AAC9B,8BAA+B,AACvB,sBAAuB,AAC/B,gCAAiC,AACjC,aAAe,CAChB,AACD,oDAVE,oBAAqB,AACrB,qBAAsB,AACtB,YAAc,CAwBf,AAhBD,2BACE,YAAa,AACb,WAAY,AACZ,mBAAoB,AACpB,kBAAmB,AACnB,WAAY,AACZ,gBAAiB,AAIjB,yBAA0B,AAC1B,2BAA4B,AACpB,mBAAoB,AAC5B,wBAAyB,AACzB,+BAAgC,AACxB,sBAAwB,CACjC,AACD,0BACE,oBAAqB,AACrB,qBAAsB,AACtB,aAAc,AACd,4BAA6B,AAC7B,6BAA8B,AAC9B,8BAA+B,AACvB,sBAAuB,AAC/B,oBAAqB,AACrB,6BAA8B,AAC9B,eAAiB,CAClB,AACD,yBACE,WAAa,CACd",file:"Annotation.vue",sourcesContent:["\n.a_warp[data-v-ef6eab44] {\n  height: 100%;\n  position: relative;\n  background: #f4f4f4;\n}\n.a_content[data-v-ef6eab44] {\n  bottom: 50px;\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n.a_foot_be[data-v-ef6eab44] {\n  height: 50px;\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-justify-content: space-around;\n          justify-content: space-around;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n          align-items: center;\n  background: #fff;\n  border-top: 1px solid #dedede;\n}\n.a_foot_after[data-v-ef6eab44] {\n  height: 50px;\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-justify-content: space-around;\n          justify-content: space-around;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n          align-items: center;\n  border-top: 1px solid #dedede;\n  background: #fff;\n}\n.a_color[data-v-ef6eab44] {\n  height: 25px;\n  width: 25px;\n  position: relative;\n}\n.a_colors[data-v-ef6eab44] {\n  position: absolute;\n  -webkit-box-pack: justify;\n  -webkit-justify-content: space-between;\n          justify-content: space-between;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  width: 100px;\n  height: 40px;\n  top: -44px;\n  left: -38px;\n}\n.a_text[data-v-ef6eab44] {\n  height: 50px;\n  width: 100%;\n  position: fixed;\n  bottom: 0;\n  z-index: 19941209;\n  left: 0;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n          align-items: center;\n  -webkit-justify-content: space-around;\n          justify-content: space-around;\n  padding: 10px 15px;\n  background: #fff;\n  border-top: 1px solid #dedede;\n}\n.a_text > input[data-v-ef6eab44] {\n  width: 80%;\n  margin-left: 2px;\n  height: 30px;\n  padding: 0 10px;\n}\n.a_image[data-v-ef6eab44] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  display: block;\n}\n.a_list[data-v-ef6eab44] {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n          flex-direction: column;\n  border-bottom: 1px solid #dedede;\n  padding: 5px 0;\n}\n.a_arcnum[data-v-ef6eab44] {\n  height: 25px;\n  width: 25px;\n  background: #FF445B;\n  border-radius: 50%;\n  color: #fff;\n  font-weight: 600;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n          justify-content: center;\n}\n.a_pizhu[data-v-ef6eab44] {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n          flex-direction: column;\n  padding: 10px 15px 0;\n  border-top: 1px solid #dedede;\n  background: #fff;\n}\n.isnone[data-v-ef6eab44] {\n  border: none;\n}\n"],sourceRoot:""}])},224:function(t,e,a){var n=a(203);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(28)("5cff6d1c",n,!0)},264:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"a_warp"},[a("div",{staticClass:"a_content",attrs:{id:"div_parent"},on:{click:t.back}},[a("div",{staticStyle:{position:"relative",width:"100%"}},[a("img",{staticStyle:{width:"100%",display:"block"},attrs:{id:"image",src:t.src,alt:""}}),t._v(" "),a("canvas",{staticStyle:{position:"absolute",top:"0",left:"0"},attrs:{id:"can"}}),t._v(" "),t._l(t.pz,function(e,n){return a("img",{directives:[{name:"show",rawName:"v-show",value:!t.start&&t.showpz,expression:"!start &&showpz"}],staticClass:"a_image",style:{zIndex:n},attrs:{src:t.setbase(e.content),alt:""}})})],2),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.start,expression:"!start"}],staticClass:"a_pizhu"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showpz,expression:"showpz"}],staticStyle:{"align-self":"flex-end","padding-bottom":"10px"},on:{click:function(e){t.showpz=!1}}},[t._v("隐藏批注")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.showpz,expression:"!showpz"}],staticStyle:{"align-self":"flex-end","padding-bottom":"10px"},on:{click:function(e){t.showpz=!0}}},[t._v("显示批注")]),t._v(" "),t._l(t.pz,function(e,n){return a("div",{directives:[{name:"show",rawName:"v-show",value:t.pz.length>0&&t.showpz,expression:"(pz.length > 0)&&showpz"}],staticClass:"a_list",class:{isnone:n==t.pz.length-1}},[a("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[a("div",{staticClass:"a_arcnum"},[t._v(t._s(e.commentIndex))]),t._v(" "),a("div",[t._v(t._s(e.upTime))])]),t._v(" "),a("div",{staticStyle:{"font-size":"14px",color:"#666","margin-top":"5px"}},[t._v(t._s(e.description))])])}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.pz.length&&t.showpz,expression:"(pz.length === 0)&&showpz"}],staticStyle:{"text-align":"center","padding-bottom":"10px",color:"#787878"}},[t._v("\n        没有有任何批注哦\n      ")])],2)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.start,expression:"!start"}],staticClass:"a_foot_be"},[a("div",{staticStyle:{color:"#4762FF"},on:{click:function(e){t.start=!0}}},[t._v("新建批注")])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.start,expression:"start"}],staticClass:"a_foot_after"},[a("div",{on:{click:t.cancel}},[t._v("取消")]),t._v(" "),a("div",{staticStyle:{width:"46%",display:"flex","justify-content":"space-around","align-items":"center"}},[a("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"},on:{click:t.undo}},[a("i",{staticClass:"iconfont",staticStyle:{"font-size":"14px"}},[t._v("")])]),t._v(" "),a("div",{staticClass:"a_color",style:{background:t.color},on:{click:function(e){t.showcolors=!t.showcolors}}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showcolors,expression:"showcolors"}],staticClass:"a_colors"},t._l(t.colors,function(e){return a("div",{staticClass:"a_color",style:{background:e},on:{click:function(a){t.setcolor(e)}}})}))]),t._v(" "),a("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"},on:{click:t.aler}},[a("i",{staticClass:"iconfont",staticStyle:{"font-size":"20px"}},[t._v("")])]),t._v(" "),a("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"},on:{click:t.redo}},[a("i",{staticClass:"iconfont",staticStyle:{"font-size":"14px"}},[t._v("")])])]),t._v(" "),a("div",{on:{click:t.over}},[t._v("确认")])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showinput,expression:"showinput"}],staticClass:"a_text"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.desc,expression:"desc"}],attrs:{id:"a_descinput",placeholder:"输入批注内容",type:"text"},domProps:{value:t.desc},on:{input:function(e){e.target.composing||(t.desc=e.target.value)}}}),t._v(" "),a("div",{staticStyle:{color:"#4762FF"},on:{click:t.submit}},[t._v("保存")])])])},staticRenderFns:[]}}});
//# sourceMappingURL=13.abbc5acacf471ef9d9c6.js.map